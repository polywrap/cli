/// NOTE: This is an auto-generated file.
///       All modifications will be overwritten.

package {{pkg}}

import io.polywrap.core.Invoker
import io.polywrap.core.InvokeResult
import io.polywrap.core.resolution.Uri
import io.polywrap.core.msgpack.MsgPackMap
import kotlinx.serialization.Serializable

typealias BigInt = String
typealias BigNumber = String
typealias Json = String

/// Env START ///
{{#envType}}
@Serializable
data class Env(
    {{#properties}}
    val {{#detectKeyword}}{{name}}{{/detectKeyword}}: {{#nullableDefault}}{{#toKotlin}}{{toGraphQLType}}{{/toKotlin}}{{/nullableDefault}},
    {{/properties}}
)
{{/envType}}
/// Env END ///

/// Objects START ///
{{#objectTypes}}
@Serializable
data class {{#toClassName}}{{type}}{{/toClassName}}(
    {{#properties}}
    val {{#detectKeyword}}{{name}}{{/detectKeyword}}: {{#nullableDefault}}{{#toKotlin}}{{toGraphQLType}}{{/toKotlin}}{{/nullableDefault}},
    {{/properties}}
)

{{/objectTypes}}
/// Objects END ///

/// Enums START ///
{{#enumTypes}}
@Serializable
enum class {{#toClassName}}{{type}}{{/toClassName}} {
    {{#constants}}
    {{#detectKeyword}}{{.}}{{/detectKeyword}}{{^last}},{{/last}}
    {{/constants}}
}

{{/enumTypes}}
/// Enums END ///

/// Imported Objects START ///
{{#importedObjectTypes}}
/* URI: "{{uri}}" */
@Serializable
data class {{#toClassName}}{{type}}{{/toClassName}}(
    {{#properties}}
    val {{#detectKeyword}}{{name}}{{/detectKeyword}}: {{#nullableDefault}}{{#toKotlin}}{{toGraphQLType}}{{/toKotlin}}{{/nullableDefault}},
    {{/properties}}
)

{{/importedObjectTypes}}
{{#importedEnumTypes}}
/* URI: "{{uri}}" */
@Serializable
enum class {{#toClassName}}{{type}}{{/toClassName}} {
    {{#constants}}
    {{#detectKeyword}}{{.}}{{/detectKeyword}}{{^last}},{{/last}}
    {{/constants}}
}

{{/importedEnumTypes}}
/// Imported Objects END ///

/// Imported Modules START ///
{{#importedModuleTypes}}
{{#methods}}
/* URI: "{{parent.uri}}" */
@Serializable
data class {{#toClassName}}{{parent.type}}{{/toClassName}}Args{{#toClassName}}{{name}}{{/toClassName}}(
    {{#arguments}}
    val {{#detectKeyword}}{{name}}{{/detectKeyword}}: {{#nullableDefault}}{{#toKotlin}}{{toGraphQLType}}{{/toKotlin}}{{/nullableDefault}},
    {{/arguments}}
)

{{/methods}}
/* URI: "{{uri}}" */
{{^isInterface}}
object {{#toClassName}}{{type}}{{/toClassName}} {
    {{#methods}}
    suspend fun {{#detectKeyword}}{{name}}{{/detectKeyword}}(
        args: {{#toClassName}}{{parent.type}}{{/toClassName}}Args{{#toClassName}}{{name}}{{/toClassName}},
        invoker: Invoker
    ): InvokeResult<{{#return}}{{#toKotlin}}{{toGraphQLType}}{{/toKotlin}}{{/return}}> {
        return invoker.invoke(
            uri = Uri.fromString("{{parent.uri}}"),
            method = "{{name}}",
            args = args
        );
    }{{^last}},{{/last}}
    {{^last}}

    {{/last}}
    {{/methods}}
}

{{/isInterface}}
{{#isInterface}}
class {{#toClassName}}{{type}}{{/toClassName}}(uri: String) {
    companion object {
        val interfaceUri: String = "{{uri}}"
    }

    val uri: Uri = Uri.fromString(uri)

    {{#methods}}
    suspend fun {{#detectKeyword}}{{name}}{{/detectKeyword}}(
        args: {{#toClassName}}{{parent.type}}{{/toClassName}}Args{{#toClassName}}{{name}}{{/toClassName}},
        invoker: Invoker
    ): InvokeResult<{{#return}}{{#toKotlin}}{{toGraphQLType}}{{/toKotlin}}{{/return}}> {
        return invoker.invoke(
            uri = this.uri,
            method = "{{name}}",
            args = args
        );
    }
  {{^last}}

  {{/last}}
  {{/methods}}
}

{{/isInterface}}
{{/importedModuleTypes}}
/// Imported Modules END ///
{{#interfaceTypes.length}}
{{#interfaceTypes}}

object {{#toClassName}}{{namespace}}{{/toClassName}} {
    val uri: Uri = Uri.fromString("{{uri}}");

    {{#capabilities}}
    {{#getImplementations}}
    {{#enabled}}
    suspend fun getImplementations(invoker: Invoker): List<String> {
        val implementations = invoker.getImplementations(this.uri)
        val uriStrings = implementations.map { it.toStringUri() }
        implementations.forEach { it.close() }
        return uriStrings
    }
    {{/enabled}}
    {{/getImplementations}}
    {{/capabilities}}
}
{{/interfaceTypes}}
{{/interfaceTypes.length}}
