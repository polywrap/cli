import {
  wrap_subinvoke,
  wrap_subinvokeImplementation,
  Box,
  BigInt,
  BigNumber,
  JSON,
  Result
} from "@polywrap/wasm-as";
{{#if functions.length}}
import {
  {{#each functions}}
  serialize{{name}}Args,
  deserialize{{name}}Result,
  Args_{{detectKeyword name}}{{^@last}},{{/@last}}
  {{/each}}
} from "./serialization";
{{/if}}
import * as Types from "../..";

{{^isInterface}}
export class {{detectKeyword name}} {

  public static uri: string = "{{uri}}";

  {{#each functions}}
  public static {{name}}(
    args: Args_{{detectKeyword name}}
  ): Result<{{#return}}{{#toWasm}}{{toGraphQLType}}{{/toWasm}}{{/return}}, string> {
    const argsBuf = serialize{{name}}Args(args);
    const result = wrap_subinvoke(
      "{{uri}}",
      "{{name}}",
      argsBuf
    );

    if (result.isErr) {
      return Result.Err<{{#return}}{{#toWasm}}{{toGraphQLType}}{{/toWasm}}{{/return}}, string>(
        result.unwrapErr()
      );
    }

    return Result.Ok<{{#return}}{{#toWasm}}{{toGraphQLType}}{{/toWasm}}{{/return}}, string>(
      deserialize{{name}}Result(result.unwrap())
    );
  }
  {{^@last}}

  {{/@last}}
  {{/each}}
}
{{/isInterface}}
{{#isInterface}}
export class {{detectKeyword type}} {

  public static interfaceUri: string = "{{uri}}";

  public uri: string;

  constructor(uri: string) {
    this.uri = uri;
  }

  {{#each functions}}
  public {{name}}(
    args: Args_{{detectKeyword name}}
  ): Result<{{#return}}{{#toWasm}}{{toGraphQLType}}{{/toWasm}}{{/return}}, string> {
    const argsBuf = serialize{{name}}Args(args);
    const result = wrap_subinvokeImplementation(
      "{{uri}}",
      this.uri,
      "{{name}}",
      argsBuf
    );

    if (result.isErr) {
      return Result.Err<{{#return}}{{#toWasm}}{{toGraphQLType}}{{/toWasm}}{{/return}}, string>(
        result.unwrapErr()
      );
    }

    return Result.Ok<{{#return}}{{#toWasm}}{{toGraphQLType}}{{/toWasm}}{{/return}}, string>(
      deserialize{{name}}Result(result.unwrap())
    );
  }
  {{^@last}}

  {{/@last}}
  {{/each}}
}
{{/isInterface}}